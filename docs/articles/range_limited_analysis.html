<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Range-limited analysis • PlasmoMAPI</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Range-limited analysis">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PlasmoMAPI</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/installation.html">Installation</a>
    </li>
    <li>
      <a href="../articles/basic_tutorial.html">Basic tutorial</a>
    </li>
    <li>
      <a href="../articles/range_limited_analysis.html">Range-limited analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/PlasmoMAPI">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Range-limited analysis</h1>
                        <h4 class="author">Bob Verity and Keith Fraser</h4>
            
            <h4 class="date">2020-02-07</h4>
      
      
      <div class="hidden name"><code>range_limited_analysis.Rmd</code></div>

    </div>

    
    
<p>Sometimes barriers/corridors of gene flow can act at different spatial scales. For example, a river might be a barrier to human movement when on foot but not at longer distances because people tend to drive and so can quickly access the nearest road bridge. We can explore this phenomenon in <em>PlasmoMAPI</em> by restricting our analysis to edges of a certain length, and ignoring anything outside the defined range. In some cases this can lead to sharper inference by reducing the amount of random noise in the data.</p>
<div id="simulating-and-loading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-and-loading-data" class="anchor"></a>Simulating and loading data</h2>
<p>We assume a uniform scatter of sampling locations, which we load into a new project.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># assume uniform scatter of sampling locations</span>
node_df &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">long =</span> <span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">2e2</span>, <span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>),
                      <span class="dt">lat =</span> <span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">2e2</span>, <span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>))

<span class="co"># create project and map</span>
p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pm_project.html">pm_project</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/load_coords.html">load_coords</a></span>(node_df<span class="op">$</span>long, node_df<span class="op">$</span>lat) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/create_map.html">create_map</a></span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/assign_map.html">assign_map</a></span>(<span class="dt">pb_markdown =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Creating hex map</span>
<span class="co">#&gt; hex size chosen automatically: 0.968</span>
<span class="co">#&gt; 481 hexagons created</span>
<span class="co">#&gt; Assigning edges to hexes</span>
<span class="co">#&gt; </span>
  <span class="op">|</span><span class="st">                                                                            </span>
<span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%</code></pre></div>
<p>As in the previous tutorial we will simulate some data with a known barrier to gene flow using the <code><a href="../reference/get_barrier_intersect.html">get_barrier_intersect()</a></code> function. This time we will assume a more detailed barrier shape to test our ability to detect small and complex features.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create barrier polygon</span>
barrier_list &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">long =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">4</span>,<span class="op">-</span><span class="dv">3</span>,<span class="op">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="op">-</span><span class="dv">5</span>,<span class="op">-</span><span class="dv">5</span>),
                                <span class="dt">lat =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">6</span>,<span class="dv">0</span>,<span class="op">-</span><span class="dv">8</span>,<span class="op">-</span><span class="dv">4</span>,<span class="op">-</span><span class="dv">3</span>,<span class="op">-</span><span class="dv">4</span>,<span class="op">-</span><span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>)))

<span class="co"># plot map with barriers</span>
<span class="kw"><a href="../reference/plot_map.html">plot_map</a></span>(p, <span class="dt">barrier_list =</span> barrier_list)</code></pre></div>
<p><img src="range_limited_analysis_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>The argument <code>max_barrier_range</code> in <code><a href="../reference/get_barrier_intersect.html">get_barrier_intersect()</a></code> allows us to define a spatial distance beyond which the barrier penalty does not apply, for example if <code>max_barrier_range = 100</code> and two sampling locations are either side of the barrier and separated by 110km then the barrier effectively does not exist between these locations. We will use this mtehod to simulate pairwise genetic distances between sampling locations, this time on the [-Inf,Inf] interval rather than the [0,1] interval just for a change.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate distances, taking into account barriers</span>
sim_dist &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_barrier_intersect.html">get_barrier_intersect</a></span>(node_df<span class="op">$</span>long, node_df<span class="op">$</span>lat,
                                  <span class="dt">barrier_list =</span> barrier_list,
                                  <span class="dt">barrier_penalty =</span> <span class="op">-</span><span class="dv">50</span>,
                                  <span class="dt">barrier_method =</span> <span class="dv">2</span>,
                                  <span class="dt">max_barrier_range =</span> <span class="dv">500</span>)

<span class="co"># add some noise to the data</span>
sim_dist_noise &lt;-<span class="st"> </span>sim_dist <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(sim_dist), <span class="dt">sd =</span> <span class="fl">2e2</span>)
genetic_distance &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span>(sim_dist_noise))</code></pre></div>
<p>Create a project, load the data, and look at a simple plot of spatial vs. genetic distance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load data and produce simple scatterplot</span>
p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_data.html">load_data</a></span>(p, genetic_distance)

<span class="kw"><a href="../reference/plot_dist.html">plot_dist</a></span>(p)</code></pre></div>
<p><img src="range_limited_analysis_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>As before, it is quite difficult to see any systematic pattern in the data.</p>
</div>
<div id="running-a-range-limited-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#running-a-range-limited-analysis" class="anchor"></a>Running a range-limited analysis</h2>
<p>Now let’s see what happens when we carry out the <em>PlasmoMAPI</em> analysis over the entire range of data, and then a second time restricting to distances less than 500km:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># run analysis over all distance and plot map</span>
p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pm_analysis.html">pm_analysis</a></span>(p, <span class="dt">max_dist =</span> <span class="ot">Inf</span>, <span class="dt">pb_markdown =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Pre-processing</span>
<span class="co">#&gt; Carrying out permutation test</span>
<span class="co">#&gt; </span>
  <span class="op">|</span><span class="st">                                                                            </span>
<span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%
<span class="kw"><a href="../reference/plot_map.html">plot_map</a></span>(p, <span class="dt">barrier_list =</span> barrier_list)</code></pre></div>
<p><img src="range_limited_analysis_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># run analysis over short distance and plot map</span>
p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/pm_analysis.html">pm_analysis</a></span>(p, <span class="dt">max_dist =</span> <span class="dv">500</span>, <span class="dt">pb_markdown =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Pre-processing</span>
<span class="co">#&gt; Carrying out permutation test</span>
<span class="co">#&gt; </span>
  <span class="op">|</span><span class="st">                                                                            </span>
<span class="st">  </span><span class="er">|======================================================================|</span><span class="st"> </span><span class="dv">100</span>%
<span class="kw"><a href="../reference/plot_map.html">plot_map</a></span>(p, <span class="dt">barrier_list =</span> barrier_list)</code></pre></div>
<p><img src="range_limited_analysis_files/figure-html/unnamed-chunk-7-2.png" width="576"></p>
<p>Notice that we didn’t find any areas of significance when using the whole dataset because the random noise at distances above 500km was washing out any signal, but when restricting to short distances the barrier becomes clear. However, throwing data away like this comes at a cost - there are now quite a number of hexes that are below our required coverage level, and so are shown in grey. The more we subset the data, the fewer edges we we have at our disposal and the fewer hexes will pass our coverage checks. So, performing a focussed analysis like this is a trade-off between precision and statistical power, and how far you can push it will depend on the number of sampling locations at hand.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simulating-and-loading-data">Simulating and loading data</a></li>
      <li><a href="#running-a-range-limited-analysis">Running a range-limited analysis</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bob Verity, Keith Fraser.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
